# Code Duel Arena: ルールブック

## 1. ゲームの目的
自分以外の全てのプレイヤーの**ライフポイント（LP）**を**20**から**0**にすること。

## 2. 特徴：QRコード搭載メソッドカード
カードは全て片面印刷です。カードには**メソッド名**と、そのメソッドが**このゲーム内で対応するクラス**（例: `String`, `Array`など）の公式ドキュメントにリンクされた**QRコード**が印刷されています。
* 複数のクラスに対応するメソッド（例: `.size`）には、その数だけQRコードが記載されており、その汎用性を示唆します。

## 3. ゲームの準備（セットアップ）
1.  **デッキ構築**: 92枚のカードプールから、後述のルールに従って30枚のデッキを構築します。
2.  **LPとKP**: LPを**20**、ナレッジポイント（KP）を**5**にセットします。KPは「KPトラッカーカード」で管理します。
3.  **手札**: 山札から手札を**5枚**引きます。
4.  **ゲーム開始**: 「初期値カード」と**「お題カード」**を山札から1枚ずつめくり、ゲームを開始します。

## 4. ゲームの流れ（フロー）
### A. 自分のターン
手札の中からカードをプレイするか、「パス」を宣言します。カードをプレイする場合、以下のいずれかを選びます。
* **シングルプレイ**: 手札からメソッドカードを1枚だけプレイします。
* **バーストチェイン**: 「バーストチェイン！」と宣言し、手札から型が繋がる限り、何枚でも連続でメソッドカードをプレイできます。もし、このチェーンが**2枚以上**で構成されており、かつ**お題を達成した場合**、その瞬間ラウンドは終了し、あなたが勝者となります。

### B. カードのプレイに関するルール
* **型の接続**: プレイするカードの入力型は、チェーン最後尾のカードの出力型と一致しなければなりません。
* **手札が0枚の場合**: 強制的に「パス」を宣言します。

### C. 切り札 (Trump Cards) の使い方：Proc引数ルール
「切り札」は、このゲームで最も強力で柔軟なカードです。切り札には2つの使い方があります。

#### **1. 通常の使い方 (Safe Play)**
切り札は、手札に他に良いカードがない場合、**単体でプレイすることもできます**。
* **効果**: その場合、出力の型は**入力の型と同じ**になります。
* **例**: `Array` に `.map` を単体でプレイした場合、出力も `Array` のままです。これは、チェーンを繋ぐための安全な一手となります。

#### **2. 真の使い方 (Power Play)：Proc引数**
切り札の真価は、手札から**もう1枚のカードを「Proc引数」として同時にプレイする**ことで発揮されます。これは、Rubyの `(&:method_name)` という美しい構文を再現した、このゲーム最強のアクションです。

* **プレイ手順**:
    1.  切り札カード（例: `.map`）を場に出します。
    2.  次に、手札から引数として使いたいカード（例: `.to_s`）を、その切り札の上に少し重ねるようにしてプレイします。
* **結果**:
    * `.map`の場合、出力は`Array`のままですが、その「中身の型」は引数カードの出力型（この場合は`String`）に変わったと見なされます。
    * `.reduce`の場合、出力は引数カードの出力型（この場合は`String`）に変わります。

### D. ラウンドの終了
誰か1人を除き、他のプレイヤー全員が「パス」を宣言したら、ラウンド終了です。

1.  **ダメージ計算（ソリューション・ダメージ）**:
    * ラウンドの勝者（最後にカードをプレイしたプレイヤー）は、パスをしたプレイヤー全員にダメージを与えます。
    * **お題を達成して勝利**: **5ダメージ**
    * **お題を達成せずに勝利**: **2ダメージ**
2.  **リフレッシュフェーズ**:
    * 場のカードを全て捨て札にします。
    * **全プレイヤーは、山札からカードを2枚引きます。**
    * **全プレイヤーは、KPを1回復します。（最大値は5）**
3.  **次のラウンドへ**: 新しい「初期値カード」と「お題カード」をめくり、次のラウンドを開始します。

## 5. その他の重要ルール
* **プレイ順のローテーション（3人以上の場合）**: 毎ラウンド、前のラウンドの最後のプレイヤーから逆順で開始します。
* **山札切れによる敗北**: プレイヤーは、山札からカードを引く必要がある時に引けなかった場合、その時点でゲームに敗北します。

## 6. KP（ナレッジポイント）
KPは、自分のターン中に、強力なアクションのために**消費**できます。（1ターンに1度まで）
* **2 KP消費**: 山札からカードを1枚引く。
* **3 KP消費**: 自分の捨て札から好きなカードを1枚手札に戻す。
* **5 KP消費**: **相手プレイヤー1人**の手札を全て見る。
* **1 KP消費**: **QRコードをスキャン**して公式ドキュメントを読む。

## 7. 上級ルール（任意）
### A. レガシー・アサーション（Legacy Assertion）
ラウンドの合間に行うボーナスチャレンジです。
* **挑戦**: ラウンドの勝者は、新しい初期値がめくられた後、手札を2枚まで使い、前のラウンドの「最終出力（遺産）」と新しい「初期値」を`==`にできるか証明します。
* **報酬**: 証明に成功した場合、**即座に自分以外の全てのプレイヤーに追加で3ダメージ**を与えます。（証明に使ったカードは捨て札になります）

### B. コードレビュー（Code Review）
相手の勝利そのものを無に帰す、究極の知識介入です。
1.  **レビューの要求**: あるプレイヤーがラウンドの勝者となった**直後**、他のどのプレイヤーも「レビューを要求します！」と宣言できます。挑戦権は、勝者の左隣のプレイヤーから時計回りに移ります。
2.  **バグの指摘**: 挑戦者は、勝利したチェーンの**どの部分が、なぜ実行時エラーになるのか**を具体的に指摘します。
3.  **裁定**:
    * **バグが発見された場合 (Bug Found! 💥)**
        1.  **勝利者の勝利は無効**となり、ダメージは**0**になります。
        2.  勝利者は、**ペナルティとして以下のどちらか1つを選択**して実行します。
            * **A: プロジェクトの炎上**: **即座に2ダメージを受ける (LP -2)**
            * **B: リソースの喪失**: **手札から好きなカードを2枚選んで捨て札にする**
        3.  バグを発見した挑戦者は、報酬として**山札からカードを2枚引きます**。
    * **バグが発見されなかった場合 (Clean Code! ✨)**
        1.  勝利者は、通常通りダメージ計算を行います。
        2.  挑戦者は、ペナルティとして**即座に1ダメージを受けます (LP -1)**。
---

# スターターセット (最終完全版)

### 1\. メソッドカードプール (全92枚)

#### A. 主力 (Main Force) \- 各種3枚まで

* **String → Array** (2種 x 3枚): `.split`, `.chars`  
* **Array → String** (2種 x 3枚): `.join`, `.to_s`  
* **String → String** (5種 x 3枚): `.upcase`, `.downcase`, `.reverse`, `.strip`, `.capitalize`  
* **Array → Array** (5種 x 3枚): `.sort`, `.uniq`, `.flatten`, `.compact`, `.reverse`  
* **Hash → Array** (2種 x 3枚): `.keys`, `.values`  
* **Numeric → String** (1種 x 3枚): `.to_s`  
* **String → Integer** (1種 x 3枚): `.to_i`  
* **Array → Integer** (1種 x 3枚): `.sum`  
* **Numeric → Numeric** (2種 x 3枚): `.abs`, `.next`

#### B. ユーティリティ (Utility) \- 各種2枚まで

* **Array → Any** (3種 x 2枚): `.first`, `.last`, `.sample`  
* **Hash → Any** (1種 x 2枚): `.dig` **(Re-added\!)**  
* **String/Array/Hash → Integer** (1種 x 2枚): `.size`  
* **Array → Hash** (1種 x 2枚): `.tally`  
* **Hash → Hash** (1種 x 2枚): `.invert`  
* **Array → Integer** (1種 x 2枚): `.count`  
* **String → Array** (1種 x 2枚): `.scan`  
* **Any → String** (1種 x 2枚): `.inspect`  
* **Array → Array** (1種 x 2枚): `.shuffle`  
* **String → String** (1種 x 2枚): `.swapcase`

#### C. 切り札 (Trump Cards) \- 各種1枚のみ

* **Array → Array** (3種 x 1枚): `.map`, `.select`, `.reject`  
* **Array → Any** (1種 x 1枚): `.reduce`  
* **Array → Hash** (1種 x 1枚): `.group_by`  
* **String → String** (1種 x 1枚): `.gsub`  
* **Hash → Hash** (1種 x 1枚): `.transform_values`  
* **Hash → Any** (1種 x 1枚): `.fetch`

### 2\. その他のカード

#### 初期値カード (10枚)

* `"Code Duel Arena" (String)`  
* `"Ruby on Rails" (String)`  
* `" first second third " (String)`  
* `[1, 5, 3, 8] (Array)`  
* `["a", "b", "c", "b"] (Array)`  
* `[10, nil, 30, 10] (Array)`  
* `2025 (Integer)`  
* `{name: "Alice", age: 20} (Hash)`  
* `{a: 1, b: 2, c: 1} (Hash)`  
* `3.14 (Float)`

#### お題カード (15枚)

* \[Easy\] 最終出力を String にせよ。  
* \[Easy\] 最終出力を Array にせよ。  
* \[Easy\] 最終出力を Integer にせよ。  
* \[Normal\] 最終出力を Hash にせよ。  
* \[Normal\] 最終出力を文字数15以上のStringにせよ。  
* \[Normal\] 最終出力を要素数5以上のArrayにせよ。  
* \[Normal\] 最終出力を値が100以上のIntegerにせよ。  
* \[Hard\] 最終出力を空のString ("") または空のArray (\[\]) にせよ。  
* \[Hard\] 最終出力を値が 0 のIntegerにせよ。  
* \[Hard\] 最終出力を\*\*ソート済みのArray\*\*にせよ。  
* \[Hard\] 最終出力を\*\*nil\*\*にせよ。  
* \[Expert\] 最終出力を回文 ("aba"など) のStringまたはArrayにせよ。  
* \[Expert\] 最終出力を**全ての要素が同じArray**にせよ。  
* \[Expert\] 最終出力を**キーが全てSymbolのHash**にせよ。  
* \[Expert\] 最終出力を**素数のInteger**にせよ。
